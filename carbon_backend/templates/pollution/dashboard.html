{% extends "base.html" %}
{% load static %}

{% block title %}Pollution Awareness - VayuNetra{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/design-system.css' %}">
<style>
    .pollution-stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .map-container {
        height: 500px;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0px 6px 24px rgba(0, 0, 0, 0.08);
    }
    
    .zone-legend {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-top: 1rem;
    }
    
    .zone-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .zone-marker {
        width: 12px;
        height: 12px;
        border-radius: 50%;
    }
    
    .zone-low { background-color: #10b981; }
    .zone-moderate { background-color: #f59e0b; }
    .zone-high { background-color: #ef4444; }
    .zone-very-high { background-color: #991b1b; }
    .zone-hazardous { background-color: #7c2d12; }
    
    .alert-item {
        padding: 1rem;
        border-radius: 12px;
        margin-bottom: 1rem;
        display: flex;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .alert-icon {
        flex-shrink: 0;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
    }
    
    .alert-content {
        flex-1;
    }
    
    .alert-title {
        font-weight: 600;
        margin-bottom: 0.25rem;
    }
    
    .alert-description {
        font-size: 0.875rem;
        color: #6b7280;
    }
    
    .alert-time {
        font-size: 0.75rem;
        color: #9ca3af;
        margin-top: 0.25rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-container">
    <!-- Page Header -->
    <div class="page-header">
        <div class="px-6">
            <h1 class="page-title">Pollution Awareness</h1>
            <p class="page-subtitle">Monitor air quality and environmental impact in your area</p>
        </div>
    </div>

    <!-- Pollution Stats Overview -->
    <div class="pollution-stats-grid">
        <div class="modern-card p-6 stat-card fade-in">
            <div class="flex items-start">
                <div class="p-3 rounded-full bg-green-100 text-green-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                <div class="ml-4 flex-1">
                    <h3 class="text-sm font-medium text-gray-500">Current AQI</h3>
                    <p class="text-2xl font-bold text-gray-800">{{ current_aqi|default:'N/A' }}</p>
                    <div class="text-xs text-gray-500 mt-1">
                        <span class="status-badge status-{{ aqi_level|default:'info' }}">{{ aqi_level|default:'Unknown' }}</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="modern-card p-6 stat-card fade-in">
            <div class="flex items-start">
                <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </div>
                <div class="ml-4 flex-1">
                    <h3 class="text-sm font-medium text-gray-500">Industrial Zones</h3>
                    <p class="text-2xl font-bold text-gray-800">{{ industrial_zones|length }}</p>
                    <div class="text-xs text-gray-500 mt-1">
                        <span class="text-blue-600 font-medium">{{ active_zones|default:0 }} active</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="modern-card p-6 stat-card fade-in">
            <div class="flex items-start">
                <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                </div>
                <div class="ml-4 flex-1">
                    <h3 class="text-sm font-medium text-gray-500">Active Alerts</h3>
                    <p class="text-2xl font-bold text-gray-800">{{ total_alerts|default:0 }}</p>
                    <div class="text-xs text-gray-500 mt-1">
                        <span class="text-yellow-600 font-medium">{{ critical_alerts|default:0 }} critical</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="modern-card p-6 stat-card fade-in">
            <div class="flex items-start">
                <div class="p-3 rounded-full bg-purple-100 text-purple-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                </div>
                <div class="ml-4 flex-1">
                    <h3 class="text-sm font-medium text-gray-500">Impact Score</h3>
                    <p class="text-2xl font-bold text-gray-800">{{ impact_score|default:'N/A' }}</p>
                    <div class="text-xs text-gray-500 mt-1">
                        <span class="text-purple-600 font-medium">Environmental impact</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Map Section -->
    <div class="modern-card p-6 mb-8">
        <div class="section-header">
            <div>
                <h2 class="section-title">Pollution Map</h2>
                <p class="text-gray-600">Real-time air quality and industrial zones</p>
            </div>
            <button class="action-btn px-4 py-2 bg-white border border-gray-200 rounded-lg hover:bg-gray-50">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                Refresh
            </button>
        </div>
        
        <div class="map-container">
            <div id="pollution-map" class="w-full h-full"></div>
        </div>
        
        <div class="zone-legend">
            <div class="zone-item">
                <div class="zone-marker zone-low"></div>
                <span class="text-sm">Good (0-50)</span>
            </div>
            <div class="zone-item">
                <div class="zone-marker zone-moderate"></div>
                <span class="text-sm">Moderate (51-100)</span>
            </div>
            <div class="zone-item">
                <div class="zone-marker zone-high"></div>
                <span class="text-sm">High (101-150)</span>
            </div>
            <div class="zone-item">
                <div class="zone-marker zone-very-high"></div>
                <span class="text-sm">Very High (151-200)</span>
            </div>
            <div class="zone-item">
                <div class="zone-marker zone-hazardous"></div>
                <span class="text-sm">Hazardous (201+)</span>
            </div>
        </div>
    </div>

    <!-- Alerts Section -->
    <div class="grid grid-1 lg:grid-2 gap-8">
        <!-- Recent Alerts -->
        <div>
            <div class="section-header">
                <div>
                    <h2 class="section-title">Recent Alerts</h2>
                    <p class="text-gray-600">Latest pollution warnings in your area</p>
                </div>
            </div>
            
            <div class="space-y-4">
                {% for alert in recent_alerts %}
                <div class="alert-item alert-card alert-{{ alert.severity|default:'warning' }} modern-card">
                    <div class="alert-icon bg-{{ alert.severity|default:'yellow' }}-100 text-{{ alert.severity|default:'yellow' }}-600">
                        {% if alert.severity == 'critical' %}üö®{% elif alert.severity == 'high' %}‚ö†Ô∏è{% else %}‚ÑπÔ∏è{% endif %}
                    </div>
                    <div class="alert-content">
                        <h4 class="alert-title">{{ alert.title|default:'Pollution Alert' }}</h4>
                        <p class="alert-description">{{ alert.message|default:'Air quality levels elevated' }}</p>
                        <p class="alert-time">{{ alert.created_at|default:now|date:'M d, Y H:i' }}</p>
                    </div>
                </div>
                {% empty %}
                <div class="modern-card p-6 text-center">
                    <p class="text-gray-500">No active alerts in your area</p>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <!-- Impact Analysis -->
        <div>
            <div class="section-header">
                <div>
                    <h2 class="section-title">Impact Analysis</h2>
                    <p class="text-gray-600">Environmental impact assessment</p>
                </div>
            </div>
            
            <div class="modern-card p-6">
                <div class="space-y-6">
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium text-gray-700">Air Quality Impact</span>
                            <span class="text-sm text-gray-500" id="air-quality-percent">75%</span>
                        </div>
                        <div class="progress-container">
                            <div class="progress-fill" id="air-quality-bar" style="width: 75%"></div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium text-gray-700">Health Risk Level</span>
                            <span class="text-sm text-gray-500" id="health-risk-percent">30%</span>
                        </div>
                        <div class="progress-container">
                            <div class="progress-fill" id="health-risk-bar" style="width: 30%"></div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium text-gray-700">Environmental Impact</span>
                            <span class="text-sm text-gray-500" id="environmental-percent">45%</span>
                        </div>
                        <div class="progress-container">
                            <div class="progress-fill" id="environmental-bar" style="width: 45%"></div>
                        </div>
                    </div>
                    
                    <div class="pt-4 border-t border-gray-200">
                        <h4 class="font-medium text-gray-900 mb-2">Recommendations</h4>
                        <ul class="text-sm text-gray-600 space-y-1">
                            <li>‚Ä¢ Limit outdoor activities during high pollution hours</li>
                            <li>‚Ä¢ Use air purifiers indoors</li>
                            <li>‚Ä¢ Consider carpooling or public transport</li>
                            <li>‚Ä¢ Monitor AQI before planning outdoor exercises</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key|default:'' }}&callback=initPollutionMap" async defer></script>
<script>
function initPollutionMap() {
    // Initialize map with pollution data
    const map = new google.maps.Map(document.getElementById('pollution-map'), {
        center: { lat: 19.0760, lng: 72.8777 }, // Mumbai coordinates
        zoom: 10,
        styles: [
            {
                featureType: "all",
                elementType: "geometry",
                stylers: [{ color: "#f5f5f5" }]
            }
        ]
    });
    
    // Add pollution zones - will be populated via API
    fetch('/api/pollution/zones/')
        .then(response => response.json())
        .then(zones => {
            zones.forEach(zone => {
                new google.maps.Circle({
                    strokeColor: zone.color || "#ef4444",
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    fillColor: zone.color || "#ef4444",
                    fillOpacity: 0.35,
                    map: map,
                    center: { lat: zone.latitude || 19.0760, lng: zone.longitude || 72.8777 },
                    radius: zone.radius || 2000
                });
            });
        })
        .catch(error => console.error('Error loading pollution zones:', error));
}
</script>
{% endblock %}
